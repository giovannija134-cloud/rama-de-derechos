import React, { useState, useEffect, useRef } from 'react';
import { Book, ChevronDown, ChevronUp, Send, Bot, Info, BookOpen } from 'lucide-react';

const db = {
  pub: { t: "Derecho Público", c: "bg-blue-50 border-blue-500 text-blue-900", b: [
    { n: "Constitucional", d: "Estructura fundamental del Estado y DDHH.", e: "Juicio de amparo.", s: "Burgoa, I. (2005)" },
    { n: "Administrativo", d: "Organización y deberes de la Admin. Pública.", e: "Licencia de construcción.", s: "Fraga, G. (2000)" },
    { n: "Penal", d: "Delitos y penas para el orden social.", e: "Proceso por robo.", s: "Castellanos, F. (2018)" },
    { n: "Procesal", d: "Trámites y organización de tribunales.", e: "Plazos judiciales.", s: "Ovalle, J. (2016)" },
    { n: "Int. Público", d: "Relaciones entre Estados.", e: "Tratados de libre comercio.", s: "Sepúlveda, C. (2004)" }
  ]},
  priv: { t: "Derecho Privado", c: "bg-emerald-50 border-emerald-500 text-emerald-900", b: [
    { n: "Civil", d: "Relaciones personales/patrimoniales.", e: "Contrato de arrendamiento.", s: "Rojina, R. (2008)" },
    { n: "Mercantil", d: "Actos de comercio y empresarios.", e: "Constitución de S.A.", s: "Mantilla, R. (1996)" },
    { n: "Int. Privado", d: "Conflictos de leyes intl.", e: "Divorcio multinacional.", s: "Pereznieto, L. (2015)" },
    { n: "Bancario", d: "Regulación de entidades financieras.", e: "Tasas de interés.", s: "Acosta, M. (1990)" },
    { n: "Prop. Intelectual", d: "Protección de creaciones mentales.", e: "Registro de marca.", s: "Ley Federal PI" }
  ]},
  soc: { t: "Derecho Social", c: "bg-amber-50 border-amber-500 text-amber-900", b: [
    { n: "Laboral", d: "Relaciones obrero-patronales.", e: "Despido injustificado.", s: "De la Cueva, M. (2003)" },
    { n: "Agrario", d: "Tenencia de la tierra/ejidos.", e: "Parcelas ejidales.", s: "Mendieta, L. (1980)" },
    { n: "Seguridad Social", d: "Protección ante riesgos (salud/vejez).", e: "Pensión IMSS.", s: "Ruiz, A. (2010)" },
    { n: "Económico", d: "Estado en la economía.", e: "Leyes antimonopolio.", s: "Witker, J. (1999)" },
    { n: "Ambiental", d: "Protección del equilibrio ecológico.", e: "Sanciones por residuos.", s: "Carmona, M. (2014)" }
  ]}
};

const Card = ({ d, color }) => {
  const [o, setO] = useState(false);
  return (
    <div className={`mb-3 border-l-4 rounded-r shadow-sm bg-white ${color}`}>
      <div className="p-3 flex justify-between cursor-pointer" onClick={() => setO(!o)}>
        <h3 className="font-bold text-sm">{d.n}</h3>{o ? <ChevronUp size={16}/> : <ChevronDown size={16}/>}
      </div>
      {o && <div className="p-3 pt-0 text-sm bg-white/50"><p><b>C:</b> {d.d}</p><p><b>E:</b> {d.e}</p><p className="text-xs text-gray-500 mt-1">Fuente: {d.s}</p></div>}
    </div>
  );
};

const MindMap = () => (
  <div className="overflow-auto p-4 bg-slate-50 rounded-xl shadow-inner border border-slate-200">
    <div className="relative min-w-[600px] h-[400px] mx-auto bg-white/40 rounded">
      <svg className="absolute w-full h-full pointer-events-none"><line x1="50%" y1="50%" x2="50%" y2="20%" stroke="#3B82F6" strokeWidth="2"/><line x1="50%" y1="50%" x2="20%" y2="70%" stroke="#10B981" strokeWidth="2"/><line x1="50%" y1="50%" x2="80%" y2="70%" stroke="#F59E0B" strokeWidth="2"/></svg>
      <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-slate-800 text-white font-bold p-4 rounded-full z-20">DERECHO</div>
      <Node top="5%" left="50%" label="PÚBLICO" color="bg-blue-600" items={db.pub.b} />
      <Node top="65%" left="15%" label="PRIVADO" color="bg-emerald-600" items={db.priv.b} />
      <Node top="65%" left="65%" label="SOCIAL" color="bg-amber-600" items={db.soc.b} />
    </div>
  </div>
);

const Node = ({ top, left, label, color, items }) => (
  <div className="absolute transform -translate-x-1/2 w-48 text-center z-10" style={{ top, left }}>
    <div className={`${color} text-white font-bold px-3 py-1 rounded shadow mb-2 text-sm`}>{label}</div>
    <div className="flex flex-wrap justify-center gap-1">{items.map((i,k)=><span key={k} className="text-[10px] bg-white border px-1 rounded">{i.n}</span>)}</div>
  </div>
);

const AI = () => {
  const [m, setM] = useState([{ r: 'ai', t: "Hola, soy tu asesor legal IA. Pregúntame sobre ramas del derecho." }]);
  const [v, setV] = useState('');
  const end = useRef(null);
  useEffect(() => end.current?.scrollIntoView({ behavior: "smooth" }), [m]);

  const send = () => {
    if (!v.trim()) return;
    const q = v.toLowerCase(), newM = [...m, { r: 'user', t: v }];
    setM(newM); setV('');
    setTimeout(() => {
      let resp = "No encontré ese dato específico.";
      if (q.includes('hola')) resp = "¡Hola! Listo para estudiar.";
      else if (q.includes('publico')) resp = "El Derecho Público regula al Estado y sus relaciones.";
      else if (q.includes('privado')) resp = "El Derecho Privado regula relaciones entre particulares.";
      else if (q.includes('social')) resp = "El Derecho Social protege grupos vulnerables.";
      else {
        [...db.pub.b, ...db.priv.b, ...db.soc.b].forEach(b => {
          if (q.includes(b.n.toLowerCase())) resp = `**${b.n}**: ${b.d} (Ej: ${b.e})`;
        });
      }
      setM([...newM, { r: 'ai', t: resp }]);
    }, 600);
  };
  return (
    <div className="bg-white rounded border h-[400px] flex flex-col">
      <div className="bg-slate-800 p-2 text-white flex gap-2 items-center"><Bot size={18}/> <span className="text-sm font-bold">Asesor IA</span></div>
      <div className="flex-1 overflow-y-auto p-2 space-y-2">{m.map((x,i)=><div key={i} className={`p-2 rounded max-w-[85%] text-xs ${x.r==='user'?'bg-blue-600 text-white ml-auto':'bg-gray-100'}`}>{x.t}</div>)}<div ref={end}/></div>
      <div className="p-2 border-t flex gap-1"><input value={v} onChange={e=>setV(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} className="flex-1 border rounded px-2 text-sm" placeholder="Pregunta..."/><button onClick={send} className="bg-blue-600 text-white p-1 rounded"><Send size={16}/></button></div>
    </div>
  );
};

export default function Homepage() {
  const [tab, setTab] = useState('res');
  return (
    <div className="min-h-screen bg-gray-50 font-sans text-gray-800 p-4 max-w-5xl mx-auto">
      <header className="flex justify-between items-center mb-6 bg-white p-3 rounded shadow-sm">
        <div className="flex items-center gap-2 text-blue-900 font-bold"><Book size={20}/> Investigación Jurídica</div>
        <div className="flex gap-2 text-sm">
          <button onClick={()=>setTab('res')} className={tab==='res'?'text-blue-600 font-bold':''}>Temario</button>
          <button onClick={()=>setTab('map')} className={tab==='map'?'text-blue-600 font-bold':''}>Mapa</button>
          <button onClick={()=>setTab('ai')} className={tab==='ai'?'text-purple-600 font-bold':''}>IA</button>
        </div>
      </header>
      <main>
        {tab === 'res' && (
          <div className="grid md:grid-cols-3 gap-4 animate-in fade-in">
            {Object.entries(db).map(([k, cat]) => (
              <div key={k}>
                <h2 className={`font-bold text-lg mb-2 border-b-2 pb-1 ${cat.c.split(' ')[1]}`}>{cat.t}</h2>
                {cat.b.map((b,i)=><Card key={i} d={b} color={cat.c}/>)}
              </div>
            ))}
          </div>
        )}
        {tab === 'map' && <MindMap />}
        {tab === 'ai' && <AI />}
      </main>
      <footer className="mt-8 text-center text-xs text-gray-400 border-t pt-4">© 2023 Estudiante de Derecho • Uso Educativo</footer>
    </div>
  );
}
